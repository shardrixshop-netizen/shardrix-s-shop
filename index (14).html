<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚öí Shardrix's Shop</title>
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Press+Start+2P&family=Cinzel:wght@400;700;900&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #f5c842;
    --dark-gold: #a87c20;
    --panel: rgba(10, 8, 5, 0.82);
    --border: #6b4f1a;
    --btn: #2a1a00;
    --btn-hover: #4a2f00;
    --green: #57ff57;
    --red: #ff5757;
    --white: #ede9e0;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    width: 100%;
    overflow-x: hidden;
  }

  body {
    font-family: 'Cinzel', serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px 60px;
    color: var(--white);
    position: relative;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: url('background.png') center center / cover;
    z-index: -2;
    will-change: transform;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(1px);
    z-index: -1;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  header {
    text-align: center;
    margin-bottom: 48px;
    animation: fadeDown 0.7s ease both;
  }

  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-30px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(30px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes titlepulse {
    0%,100% { opacity: 1; }
    50%      { opacity: 0.72; }
  }

  header h1 {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(2rem, 6vw, 3.8rem);
    font-weight: 700;
    color: var(--gold);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    animation: titlepulse 4s ease-in-out infinite;
  }

  header p {
    font-size: 0.9rem;
    color: #c9b99a;
    margin-top: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  .divider {
    width: 260px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    margin: 14px auto;
    opacity: 0.8;
  }

  .currency-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(20,12,0,0.8);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 16px;
    font-size: 0.78rem;
    color: var(--gold);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-top: 12px;
  }

  .currency-badge img {
    width: 22px;
    height: 22px;
    image-rendering: pixelated;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 28px;
    animation: fadeUp 0.5s ease both;
  }

  @media (max-width: 700px) {
    .grid {
      grid-template-columns: 1fr;
    }
  }

  .card {
    background: var(--panel);
    border: 2px solid var(--border);
    border-radius: 4px;
    padding: 32px 28px 28px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 18px;
    position: relative;
    transition: transform 0.25s, box-shadow 0.25s, border-color 0.25s;
    box-shadow: 0 8px 32px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,200,60,0.08);
  }

  .card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 4px;
    background: linear-gradient(145deg, rgba(255,200,60,0.04) 0%, transparent 60%);
    pointer-events: none;
  }

  .card:hover {
    transform: translateY(-6px) scale(1.01);
    box-shadow: 0 16px 48px rgba(0,0,0,0.85), 0 0 20px rgba(245,200,66,0.15);
    border-color: var(--gold);
  }

  .item-icon {
    width: 96px;
    height: 96px;
    image-rendering: pixelated;
    filter: drop-shadow(0 4px 16px rgba(0,0,0,0.8));
    transition: transform 0.3s;
  }

  .card:hover .item-icon {
    transform: scale(1.1) rotate(-2deg);
  }

  .item-name {
    font-family: 'Cinzel Decorative', serif;
    font-size: 1.15rem;
    font-weight: 700;
    color: var(--gold);
    text-align: center;
    letter-spacing: 0.04em;
  }

  .item-desc {
    font-size: 0.78rem;
    color: #b5a88a;
    text-align: center;
    letter-spacing: 0.08em;
    line-height: 1.6;
  }

  .price-tag {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(245,200,66,0.35);
    border-radius: 4px;
    padding: 8px 18px;
    font-size: 0.9rem;
    color: var(--gold);
    letter-spacing: 0.05em;
  }

  .price-tag img {
    width: 24px;
    height: 24px;
    image-rendering: pixelated;
  }

  .price-tag strong {
    font-family: 'Press Start 2P', monospace;
    font-size: 0.75rem;
    color: #ffe87a;
  }

  .qty-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .qty-btn {
    width: 32px; height: 32px;
    background: var(--btn);
    border: 1px solid var(--border);
    color: var(--gold);
    font-size: 1.1rem;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    border-radius: 3px;
    transition: background 0.15s;
    font-family: 'Cinzel', serif;
    user-select: none;
  }

  .qty-btn:hover { background: var(--btn-hover); }

  .qty-display {
    font-family: 'Press Start 2P', monospace;
    font-size: 0.7rem;
    color: var(--white);
    min-width: 28px;
    text-align: center;
  }

  .buy-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #3d2500, #1a0f00);
    border: 2px solid var(--gold);
    border-radius: 4px;
    color: var(--gold);
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.85rem;
    letter-spacing: 0.12em;
    cursor: pointer;
    text-transform: uppercase;
    transition: background 0.2s, box-shadow 0.2s, color 0.2s;
    position: relative;
    overflow: hidden;
  }

  .buy-btn::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(245,200,66,0.12) 0%, transparent 60%);
    opacity: 0;
    transition: opacity 0.2s;
  }

  .buy-btn:hover {
    background: linear-gradient(135deg, #6b4200, #3d2500);
    box-shadow: 0 0 20px rgba(245,200,66,0.3);
    color: #ffe87a;
  }

  .buy-btn:hover::after { opacity: 1; }

  .buy-btn:active { transform: scale(0.98); }

  .toast {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: rgba(10, 8, 5, 0.95);
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 12px 28px;
    border-radius: 4px;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    z-index: 999;
    transition: transform 0.3s ease;
    pointer-events: none;
  }

  .toast.show {
    transform: translateX(-50%) translateY(0);
  }

  .total-bar {
    margin-top: 40px;
    background: var(--panel);
    border: 2px solid var(--border);
    border-radius: 4px;
    padding: 20px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
    animation: fadeUp 0.5s ease both;
  }

  .total-bar span {
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    color: #b5a88a;
    text-transform: uppercase;
  }

  .total-amount {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'Press Start 2P', monospace;
    font-size: 0.85rem;
    color: var(--gold);
  }

  .total-amount img {
    width: 22px; height: 22px;
    image-rendering: pixelated;
  }

  .checkout-btn {
    padding: 12px 28px;
    background: linear-gradient(135deg, #1e4d00, #0a1f00);
    border: 2px solid #57ff57;
    border-radius: 4px;
    color: var(--green);
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.75rem;
    letter-spacing: 0.12em;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.2s;
  }

  .checkout-btn:hover {
    background: linear-gradient(135deg, #2d6f00, #1a3800);
    box-shadow: 0 0 20px rgba(87,255,87,0.25);
  }

  footer {
    text-align: center;
    margin-top: 32px;
    margin-bottom: 20px;
    font-size: 0.82rem;
    color: var(--gold);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    position: relative;
    z-index: 1;
    background: rgba(10,8,5,0.75);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px 24px;
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
  }

  /* Modal overlay */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.active { display: flex; }

  .modal-box {
    background: #110d05;
    border: 2px solid var(--gold);
    border-radius: 6px;
    padding: 36px 32px 28px;
    width: 100%;
    max-width: 380px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    box-shadow: 0 0 60px rgba(0,0,0,0.9);
    animation: fadeDown 0.25s ease;
  }

  .modal-box h2 {
    font-family: 'Cinzel Decorative', serif;
    font-size: 1rem;
    color: var(--gold);
    text-align: center;
    letter-spacing: 0.08em;
  }

  .modal-box input {
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px 14px;
    color: var(--white);
    font-family: 'Cinzel', serif;
    font-size: 0.85rem;
    outline: none;
    transition: border-color 0.2s;
    width: 100%;
  }
  .modal-box input:focus { border-color: var(--gold); }
  .modal-box input::placeholder { color: #5a4e3a; }

  .modal-btns {
    display: flex;
    gap: 10px;
  }

  .modal-cancel {
    flex: 1;
    padding: 11px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 4px;
    color: #7a6e5a;
    font-family: 'Cinzel', serif;
    font-size: 0.75rem;
    cursor: pointer;
    letter-spacing: 0.08em;
    transition: border-color 0.2s, color 0.2s;
  }
  .modal-cancel:hover { border-color: #9a8c76; color: #9a8c76; }

  .modal-confirm {
    flex: 2;
    padding: 11px;
    background: linear-gradient(135deg, #3d2500, #1a0f00);
    border: 2px solid var(--gold);
    border-radius: 4px;
    color: var(--gold);
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.75rem;
    cursor: pointer;
    letter-spacing: 0.1em;
    transition: background 0.2s, box-shadow 0.2s;
  }
  .modal-confirm:hover {
    background: linear-gradient(135deg, #6b4200, #3d2500);
    box-shadow: 0 0 16px rgba(245,200,66,0.25);
  }

  /* Category tabs */
  .category-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 28px;
    flex-wrap: wrap;
  }

  .tab-btn {
    padding: 9px 22px;
    background: var(--btn);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: #9a8c76;
    font-family: 'Cinzel', serif;
    font-size: 0.72rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s, border-color 0.2s, color 0.2s;
  }

  .tab-btn:hover {
    background: var(--btn-hover);
    color: var(--gold);
    border-color: var(--dark-gold);
  }

  .tab-btn.active {
    background: linear-gradient(135deg, #3d2500, #1a0f00);
    border-color: var(--gold);
    color: var(--gold);
    box-shadow: 0 0 12px rgba(245,200,66,0.2);
  }

  .tab-btn.tab-all {
    border-color: #4a7c8a;
    color: #4dd9c0;
  }
  .tab-btn.tab-all:hover, .tab-btn.tab-all.active {
    background: linear-gradient(135deg, #0a2a30, #051518);
    border-color: #4dd9c0;
    color: #4dd9c0;
    box-shadow: 0 0 12px rgba(77,217,192,0.2);
  }

  .tab-btn.tab-sell {
    border-color: #2a6b3a;
    color: #57ff57;
  }
  .tab-btn.tab-sell:hover, .tab-btn.tab-sell.active {
    background: linear-gradient(135deg, #0a2a14, #051208);
    border-color: #57ff57;
    color: #57ff57;
    box-shadow: 0 0 12px rgba(87,255,87,0.2);
  }

  .category-panel {
    display: none;
  }

  .category-panel.active {
    display: contents;
  }

</style>
</head>
<body>

<div class="container">
  <header>
    <h1>‚öí Shardrix's Shop <sup style="font-family:'Press Start 2P',monospace;font-size:0.28em;color:#4dd9c0;letter-spacing:0.05em;vertical-align:super;opacity:0.9;">beta</sup></h1>
    <div class="divider"></div>
    <p>Trade with a great merchant in the realm of simply 2</p>
    <div class="currency-badge">
      <img src="netherite_ingot.png" alt="Netherite Ingot">
      Ingots &amp;
      <img src="netherite_scrap.png" alt="Netherite Scrap">
      Scrap
      <span style="color:#9a8c76;font-size:0.85em;">‚Äî 4 Scrap = 1 Ingot</span>
    </div>
  </header>

  <div class="grid">

    <!-- Tab buttons -->
    <div class="category-tabs" style="grid-column:1/-1;">
      <button class="tab-btn tab-all active" onclick="switchTab('all', this)">All</button>
      <button class="tab-btn" onclick="switchTab('random', this)">Random</button>
      <button class="tab-btn" onclick="switchTab('mobdrops', this)">Mob Drops</button>
      <button class="tab-btn" onclick="switchTab('gear', this)">Gear</button>
      <button class="tab-btn tab-sell" onclick="switchTab('sell', this)" style="margin-left:auto;">Sell</button>
    </div>

    <!-- All category -->
    <div class="category-panel active" id="panel-all">
      <!-- TNT -->
      <div class="card">
        <img class="item-icon" src="tnt.png" alt="TNT">
        <div class="item-name">TNT Bundle</div>
        <div class="item-desc">3 stacks of TNT (192 blocks)<br>Light it up and watch the world burn.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>1</strong> &nbsp;Netherite Ingot</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('tnt',-1)">‚àí</button>
          <span class="qty-display" id="tnt-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('tnt',1)">+</button>
        </div>
      </div>
      <!-- Mace -->
      <div class="card">
        <div style="position:relative;width:96px;height:96px;">
          <img class="item-icon" src="mace.png" alt="Mace" style="width:96px;height:96px;">
          <span style="position:absolute;top:-6px;right:-10px;background:#ff5757;color:#fff;font-family:'Press Start 2P',monospace;font-size:0.42rem;padding:3px 6px;border-radius:3px;letter-spacing:0.05em;white-space:nowrap;">OUT OF STOCK</span>
        </div>
        <div class="item-name">Mace</div>
        <div class="item-desc">A fearsome weapon of war.<br>Crush your enemies beneath its weight.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>5</strong> &nbsp;Netherite Ingots</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>
      <!-- End Crystal -->
      <div class="card">
        <img class="item-icon" src="end_crystal.png" alt="End Crystal">
        <div class="item-name">End Crystal</div>
        <div class="item-desc">1 stack of End Crystals<br>Volatile and devastating in the right hands.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>1</strong> &nbsp;Netherite Ingot</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('crystal',-1)">‚àí</button>
          <span class="qty-display" id="crystal-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('crystal',1)">+</button>
        </div>
      </div>
      <!-- Respawn Anchor -->
      <div class="card">
        <img class="item-icon" src="respawn_anchor.png" alt="Respawn Anchor">
        <div class="item-name">Respawn Anchor</div>
        <div class="item-desc">1 Stack of Respawn Anchors<br>Set your spawn in the Nether ‚Äî or explode your enemies in the Overworld.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>4</strong> &nbsp;Netherite Ingots</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('anchor',-1)">‚àí</button>
          <span class="qty-display" id="anchor-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('anchor',1)">+</button>
        </div>
      </div>
      <!-- Elytra -->
      <div class="card">
        <img class="item-icon" src="elytra.png" alt="Elytra">
        <div class="item-name">Elytra</div>
        <div class="item-desc">Soar through the skies.<br>Wings of the brave.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>2</strong> &nbsp;Netherite Ingots</div>
        <button onclick="openEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('elytra',-1)">‚àí</button>
          <span class="qty-display" id="elytra-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('elytra',1)">+</button>
        </div>
      </div>
      <!-- Breeze Rods -->
      <div class="card">
        <img class="item-icon" src="breeze_rod.png" alt="Breeze Rod">
        <div class="item-name">Breeze Rods</div>
        <div class="item-desc">3 stacks of Breeze Rods<br>Harvested from chaotic living winds.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>1</strong> &nbsp;Netherite Ingot</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('breeze',-1)">‚àí</button>
          <span class="qty-display" id="breeze-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('breeze',1)">+</button>
        </div>
      </div>
      <!-- Blaze Rods -->
      <div class="card">
        <img class="item-icon" src="blaze_rod.png" alt="Blaze Rod">
        <div class="item-name">Blaze Rods</div>
        <div class="item-desc">3 stacks of Blaze Rods<br>Blazing fuel from the Nether.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>1</strong> &nbsp;Netherite Ingot</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('blazeRod',-1)">‚àí</button>
          <span class="qty-display" id="blazeRod-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('blazeRod',1)">+</button>
        </div>
      </div>
      <!-- Shulker Shells -->
      <div class="card">
        <img class="item-icon" src="shulker_shell.png" alt="Shulker Shell">
        <div class="item-name">Shulker Shells</div>
        <div class="item-desc">32 Shulker Shells<br>The rarest mob drop. Build your storage empire.</div>
        <div class="price-tag"><img src="netherite_ingot.png" alt="Netherite Ingot"><strong>1</strong> &nbsp;Netherite Ingot</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('shulkerShell',-1)">‚àí</button>
          <span class="qty-display" id="shulkerShell-qty-all">0</span>
          <button class="qty-btn" onclick="changeQty('shulkerShell',1)">+</button>
        </div>
      </div>
      <!-- Pickaxe -->
      <div class="card">
        <img class="item-icon" src="netherite_pickaxe.png" alt="Pickaxe">
        <div class="item-name">Pickaxe</div>
        <div class="item-desc">A trusty pickaxe.<br>Mine your way to glory.</div>
        <div class="price-tag"><img src="netherite_scrap.png" alt="Netherite Scrap"><strong>2</strong> &nbsp;Netherite Scrap</div>
        <button onclick="openGearEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div style="font-family:'Press Start 2P',monospace;font-size:0.45rem;color:#ff5757;letter-spacing:0.06em;text-transform:uppercase;">Currently Unavailable</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>
      <!-- Axe -->
      <div class="card">
        <img class="item-icon" src="netherite_axe.png" alt="Axe">
        <div class="item-name">Axe</div>
        <div class="item-desc">Sharp and reliable.<br>Chop or combat ‚Äî your call.</div>
        <div class="price-tag"><img src="netherite_scrap.png" alt="Netherite Scrap"><strong>2</strong> &nbsp;Netherite Scrap</div>
        <button onclick="openGearEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div style="font-family:'Press Start 2P',monospace;font-size:0.45rem;color:#ff5757;letter-spacing:0.06em;text-transform:uppercase;">Currently Unavailable</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>
      <!-- Shovel -->
      <div class="card">
        <img class="item-icon" src="netherite_shovel.png" alt="Shovel">
        <div class="item-name">Shovel</div>
        <div class="item-desc">Dig deep, find treasure.<br>Essential for any adventurer.</div>
        <div class="price-tag"><img src="netherite_scrap.png" alt="Netherite Scrap"><strong>2</strong> &nbsp;Netherite Scrap</div>
        <button onclick="openGearEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div style="font-family:'Press Start 2P',monospace;font-size:0.45rem;color:#ff5757;letter-spacing:0.06em;text-transform:uppercase;">Currently Unavailable</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>
    </div>

    <!-- Random category -->
    <div class="category-panel" id="panel-random">
      <!-- TNT Card -->
    <div class="card">
      <img class="item-icon" src="tnt.png" alt="TNT">
      <div class="item-name">TNT Bundle</div>
      <div class="item-desc">3 stacks of TNT (192 blocks)<br>Light it up and watch the world burn.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>1</strong> &nbsp;Netherite Ingot
      </div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('tnt',-1)">‚àí</button>
        <span class="qty-display" id="tnt-qty">0</span>
        <button class="qty-btn" onclick="changeQty('tnt',1)">+</button>
      </div>
    </div>

      <!-- Mace Card -->
    <div class="card">
      <div style="position:relative;width:96px;height:96px;">
        <img class="item-icon" src="mace.png" alt="Mace" style="width:96px;height:96px;">
        <span style="position:absolute;top:-6px;right:-10px;background:#ff5757;color:#fff;font-family:'Press Start 2P',monospace;font-size:0.42rem;padding:3px 6px;border-radius:3px;letter-spacing:0.05em;white-space:nowrap;">OUT OF STOCK</span>
      </div>
      <div class="item-name">Mace</div>
      <div class="item-desc">A fearsome weapon of war.<br>Crush your enemies beneath its weight.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>5</strong> &nbsp;Netherite Ingots
      </div>
      <div class="qty-row">
        <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
        <span class="qty-display" id="mace-qty">0</span>
        <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
      </div>
    </div>

      <!-- End Crystal Card -->
    <div class="card">
      <img class="item-icon" src="end_crystal.png" alt="End Crystal">
      <div class="item-name">End Crystal</div>
      <div class="item-desc">1 stack of End Crystals<br>Volatile and devastating in the right hands.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>1</strong> &nbsp;Netherite Ingot
      </div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('crystal',-1)">‚àí</button>
        <span class="qty-display" id="crystal-qty">0</span>
        <button class="qty-btn" onclick="changeQty('crystal',1)">+</button>
      </div>
    </div>

      <!-- Respawn Anchor Card -->
    <div class="card">
      <img class="item-icon" src="respawn_anchor.png" alt="Respawn Anchor">
      <div class="item-name">Respawn Anchor</div>
      <div class="item-desc">1 Stack of Respawn Anchors<br>Set your spawn in the Nether ‚Äî or explode your enemies in the Overworld.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>4</strong> &nbsp;Netherite Ingots
      </div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('anchor',-1)">‚àí</button>
        <span class="qty-display" id="anchor-qty">0</span>
        <button class="qty-btn" onclick="changeQty('anchor',1)">+</button>
      </div>
    </div>

      <!-- Elytra Card -->
    <div class="card" id="elytra-card">
      <img class="item-icon" id="elytra-icon" src="elytra.png" alt="Elytra">
      <div class="item-name">Elytra</div>
      <div class="item-desc">Soar through the skies.<br>Wings of the brave.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot"> <strong>2</strong> &nbsp;Netherite Ingots
      </div>
      <button onclick="event.stopPropagation();openEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
        <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
      </button>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('elytra',-1)">‚àí</button>
        <span class="qty-display" id="elytra-qty">0</span>
        <button class="qty-btn" onclick="changeQty('elytra',1)">+</button>
      </div>
    </div>
    </div>

    <!-- Mob Drops category -->
    <div class="category-panel" id="panel-mobdrops">
      <!-- Breeze Rod Card -->
    <div class="card">
      <img class="item-icon" src="breeze_rod.png" alt="Breeze Rod">
      <div class="item-name">Breeze Rods</div>
      <div class="item-desc">3 stacks of Breeze Rods<br>Harvested from chaotic living winds.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>1</strong> &nbsp;Netherite Ingot
      </div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('breeze',-1)">‚àí</button>
        <span class="qty-display" id="breeze-qty">0</span>
        <button class="qty-btn" onclick="changeQty('breeze',1)">+</button>
      </div>
    </div>

      <!-- Blaze Rod Card -->
    <div class="card">
      <img class="item-icon" src="blaze_rod.png" alt="Blaze Rod">
      <div class="item-name">Blaze Rods</div>
      <div class="item-desc">3 stacks of Blaze Rods<br>Blazing fuel from the Nether.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>1</strong> &nbsp;Netherite Ingot
      </div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('blazeRod',-1)">‚àí</button>
        <span class="qty-display" id="blazeRod-qty">0</span>
        <button class="qty-btn" onclick="changeQty('blazeRod',1)">+</button>
      </div>
    </div>

      <!-- Shulker Shell Card -->
    <div class="card">
      <img class="item-icon" src="shulker_shell.png" alt="Shulker Shell">
      <div class="item-name">Shulker Shells</div>
      <div class="item-desc">32 Shulker Shells<br>The rarest mob drop. Build your storage empire.</div>
      <div class="price-tag">
        <img src="netherite_ingot.png" alt="Netherite Ingot">
        <strong>1</strong> &nbsp;Netherite Ingot
      </div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty('shulkerShell',-1)">‚àí</button>
        <span class="qty-display" id="shulkerShell-qty">0</span>
        <button class="qty-btn" onclick="changeQty('shulkerShell',1)">+</button>
      </div>
    </div>
    </div> <!-- end panel-mobdrops -->

    <!-- Sell category -->
    <div class="category-panel" id="panel-sell">
      <!-- Shulker Box of Sand Card -->
      <div class="card" style="border-color:#1e3d28;background:rgba(8,18,11,0.85);box-shadow:0 8px 32px rgba(0,0,0,0.7),inset 0 1px 0 rgba(87,255,87,0.03);">
        <div style="position:relative;width:96px;height:96px;">
          <img class="item-icon" src="sand.png" alt="Sand" style="width:96px;height:96px;">
          <img src="shulker_box.png" alt="Shulker Box" style="position:absolute;bottom:2px;left:2px;width:34px;height:34px;image-rendering:pixelated;filter:drop-shadow(1px 1px 2px rgba(0,0,0,0.9));">
        </div>
        <div class="item-name" style="color:#7abf8e;">Sand</div>
        <div class="item-desc">1 Shulker Box of Sand<br>Sell your sand for ingots.</div>
        <div class="price-tag" style="border-color:rgba(87,255,87,0.18);color:#7abf8e;">
          <img src="netherite_ingot.png" alt="Netherite Ingot">
          <strong style="color:#9dd4ae;">1</strong> &nbsp;Netherite Ingot
        </div>
        <div class="qty-row">
          <button class="qty-btn" onclick="changeQty('sand',-1)">‚àí</button>
          <span class="qty-display" id="sand-qty">0</span>
          <button class="qty-btn" onclick="changeQty('sand',1)">+</button>
        </div>
      </div>
    </div>



    <!-- Gear category -->
    <div class="category-panel" id="panel-gear">

      <!-- Pickaxe Card -->
      <div class="card">
        <img class="item-icon" src="netherite_pickaxe.png" alt="Pickaxe">
        <div class="item-name">Pickaxe</div>
        <div class="item-desc">A trusty pickaxe.<br>Mine your way to glory.</div>
        <div class="price-tag">
          <img src="netherite_scrap.png" alt="Netherite Scrap">
          <strong>2</strong> &nbsp;Netherite Scrap
        </div>
        <button onclick="openGearEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div style="font-family:'Press Start 2P',monospace;font-size:0.45rem;color:#ff5757;letter-spacing:0.06em;text-transform:uppercase;">Currently Unavailable</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display" id="pickaxe-qty">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>

      <!-- Axe Card -->
      <div class="card">
        <img class="item-icon" src="netherite_axe.png" alt="Axe">
        <div class="item-name">Axe</div>
        <div class="item-desc">Sharp and reliable.<br>Chop or combat ‚Äî your call.</div>
        <div class="price-tag">
          <img src="netherite_scrap.png" alt="Netherite Scrap">
          <strong>2</strong> &nbsp;Netherite Scrap
        </div>
        <button onclick="openGearEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div style="font-family:'Press Start 2P',monospace;font-size:0.45rem;color:#ff5757;letter-spacing:0.06em;text-transform:uppercase;">Currently Unavailable</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display" id="axe-qty">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>

      <!-- Shovel Card -->
      <div class="card">
        <img class="item-icon" src="netherite_shovel.png" alt="Shovel">
        <div class="item-name">Shovel</div>
        <div class="item-desc">Dig deep, find treasure.<br>Essential for any adventurer.</div>
        <div class="price-tag">
          <img src="netherite_scrap.png" alt="Netherite Scrap">
          <strong>2</strong> &nbsp;Netherite Scrap
        </div>
        <button onclick="openGearEnchantModal()" style="display:flex;align-items:center;gap:6px;background:rgba(192,132,252,0.12);border:1px solid #c084fc;border-radius:4px;padding:5px 12px;color:#c084fc;font-family:'Cinzel',serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-transform:uppercase;transition:background 0.2s;" onmouseover="this.style.background='rgba(192,132,252,0.22)'" onmouseout="this.style.background='rgba(192,132,252,0.12)'">
          <img src="enchanted_book.png" alt="" style="width:16px;height:16px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'"> View Enchants
        </button>
        <div style="font-family:'Press Start 2P',monospace;font-size:0.45rem;color:#ff5757;letter-spacing:0.06em;text-transform:uppercase;">Currently Unavailable</div>
        <div class="qty-row">
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">‚àí</button>
          <span class="qty-display" id="shovel-qty">0</span>
          <button class="qty-btn" disabled style="opacity:0.35;cursor:not-allowed;">+</button>
        </div>
      </div>

    </div>
  </div>

  <div class="total-bar">
    <div style="display:flex;flex-direction:column;gap:8px;flex:1;">
      <span style="font-size:0.7rem;letter-spacing:0.18em;color:#9a8c76;text-transform:uppercase;">Your Order</span>
      <div id="cart-items" style="font-size:0.82rem;color:#ede9e0;letter-spacing:0.05em;line-height:1.8;display:flex;flex-direction:column;gap:2px;"></div>
    </div>
    <div style="display:flex;flex-direction:column;align-items:flex-end;gap:10px;">
    <div class="total-amount">
      <span id="cart-total">0</span>
    </div>
    <button class="checkout-btn" onclick="checkout()">‚úâ Send Order</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="paymentModal" onclick="if(event.target===this)closePaymentModal()">
  <div class="modal-box">
    <h2>üí∞ Payment First</h2>
    <p style="font-size:0.8rem;color:#c9b99a;text-align:center;line-height:1.7;letter-spacing:0.05em;">
      This is a player-to-player trade.<br>
      You must <strong style="color:var(--gold);">drop your Netherite Ingots first</strong><br>
      before receiving your items.
    </p>
    <div id="payment-order-summary" style="font-size:0.78rem;color:#ede9e0;background:rgba(0,0,0,0.35);border:1px solid var(--border);border-radius:4px;padding:12px 16px;line-height:2;letter-spacing:0.04em;"></div>
    <div class="modal-btns">
      <button class="modal-cancel" onclick="closePaymentModal()">Cancel</button>
      <button class="modal-confirm" onclick="acceptPayment()">I Understand ‚Äî Continue</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="usernameModal" onclick="if(event.target===this)closeModal()">
  <div class="modal-box">
    <h2>‚öí Enter Your Username</h2>
    <input type="text" id="usernameInput" placeholder="Minecraft username..." maxlength="32" style="color:#ede9e0;" />
    <textarea id="orderNotes" placeholder="Notes (optional) ‚Äî e.g. preferred meeting time, meeting location..." maxlength="300" style="background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:4px;padding:12px 14px;color:var(--white);font-family:'Cinzel',serif;font-size:0.78rem;outline:none;transition:border-color 0.2s;width:100%;resize:vertical;min-height:70px;line-height:1.5;" onfocus="this.style.borderColor='var(--gold)'" onblur="this.style.borderColor=''"></textarea>
    <div class="modal-btns">
      <button class="modal-cancel" onclick="closeModal()">Cancel</button>
      <button class="modal-confirm" onclick="confirmOrder()">‚úâ Confirm Order</button>
    </div>
  </div>
</div>

<div id="error-box" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:200;align-items:center;justify-content:center;">
  <div style="background:#1a0000;border:2px solid #ff5757;border-radius:6px;padding:28px 32px;max-width:480px;width:90%;display:flex;flex-direction:column;gap:14px;">
    <div style="font-family:'Cinzel Decorative',serif;color:#ff5757;font-size:0.95rem;letter-spacing:0.06em;">‚ùå Email Failed</div>
    <div id="error-msg" style="font-family:monospace;font-size:0.8rem;color:#ffaaaa;word-break:break-all;line-height:1.6;background:rgba(0,0,0,0.4);padding:10px;border-radius:4px;"></div>
    <button onclick="document.getElementById('error-box').style.display='none'" style="align-self:flex-end;padding:8px 20px;background:transparent;border:1px solid #ff5757;border-radius:4px;color:#ff5757;font-family:'Cinzel',serif;font-size:0.75rem;cursor:pointer;letter-spacing:0.1em;">Dismiss</button>
  </div>
</div>

<div class="toast" id="toast">Item added to cart!</div>

<footer id="payment-footer" style="display:none;">üí∞ Payment first ‚Äî drop your ingots before receiving goods.</footer>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>

  // ‚îÄ‚îÄ Enchant info modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openEnchantModal() {
    document.getElementById('enchantModal').classList.add('active');
  }
  function closeEnchantModal() {
    document.getElementById('enchantModal').classList.remove('active');
  }
  function openGearEnchantModal() {
    document.getElementById('gearEnchantModal').classList.add('active');
  }
  function closeGearEnchantModal() {
    document.getElementById('gearEnchantModal').classList.remove('active');
  }

  function switchTab(name, btn) {
    // Deactivate all panels and buttons
    document.querySelectorAll('.category-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    // Activate selected
    document.getElementById('panel-' + name).classList.add('active');
    btn.classList.add('active');
  }

  emailjs.init('u-UWnKizSww8kL3_t');

  const qtys = { tnt: 0, mace: 0, breeze: 0, crystal: 0, anchor: 0, elytra: 0, blazeRod: 0, shulkerShell: 0, sand: 0, pickaxe: 0, axe: 0, shovel: 0 };
  const prices = { tnt: 1, mace: 5, breeze: 1, crystal: 1, anchor: 4, elytra: 2, blazeRod: 1, shulkerShell: 1, sand: 1, pickaxe: 0, axe: 0, shovel: 0 };
  const scrapPrices = { pickaxe: 2, axe: 2, shovel: 2 };
  const sellItems = new Set(['sand']);
  const cartNames = { tnt: '3 Stacks of TNT', mace: 'Mace', breeze: '3 Stacks of Breeze Rods', crystal: '1 Stack of End Crystals', anchor: '1 Stack of Respawn Anchors', elytra: 'Elytra', blazeRod: '3 Stacks of Blaze Rods', shulkerShell: 'Shulker Shells', sand: '1 Shulker Box of Sand (Selling)', pickaxe: 'Pickaxe', axe: 'Axe', shovel: 'Shovel' };
  const purchased = { tnt: 0, mace: 0, breeze: 0, crystal: 0, anchor: 0, elytra: 0, blazeRod: 0, shulkerShell: 0, sand: 0, pickaxe: 0, axe: 0, shovel: 0 };

  function changeQty(item, delta) {
    qtys[item] = Math.max(0, qtys[item] + delta);
    // Update all qty displays for this item across all tabs
    ['', '-all'].forEach(suffix => {
      const el = document.getElementById(item + '-qty' + suffix);
      if (el) el.textContent = qtys[item];
    });
    updateTotal();
  }

  function changeQtyAll(item, delta) {
    changeQty(item, delta);
  }

  const SCRAP_ICON = '<img src="netherite_scrap.png" alt="ü™®" style="width:16px;height:16px;image-rendering:pixelated;vertical-align:middle;margin-right:3px;" onerror="this.replaceWith(document.createTextNode(\'ü™®\'))">';
  const INGOT_ICON = '<img src="netherite_ingot.png" alt="üíé" style="width:16px;height:16px;image-rendering:pixelated;vertical-align:middle;margin-right:3px;" onerror="this.replaceWith(document.createTextNode(\'üíé\'))">';
  const MODAL_SCRAP_ICON = '<img src="netherite_scrap.png" alt="ü™®" style="width:16px;height:16px;image-rendering:pixelated;vertical-align:middle;margin-right:3px;" onerror="this.replaceWith(document.createTextNode(\'ü™®\'))">';
  const MODAL_INGOT_ICON = '<img src="netherite_ingot.png" alt="üíé" style="width:16px;height:16px;image-rendering:pixelated;vertical-align:middle;margin-right:3px;" onerror="this.replaceWith(document.createTextNode(\'üíé\'))">';

  function updateTotal() {
    let totalIngots = 0;
    let totalScrap = 0;
    let parts = [];
    for (const k in qtys) {
      const isSell = sellItems.has(k);
      if (isSell) {
        totalIngots -= qtys[k] * prices[k];
      } else {
        totalIngots += qtys[k] * prices[k];
      }
      if (scrapPrices[k]) totalScrap += qtys[k] * scrapPrices[k];
      if (qtys[k] > 0) {
        if (scrapPrices[k]) {
          const sc = qtys[k] * scrapPrices[k];
          parts.push(`<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;"><span>${formatQuantity(k, qtys[k])}</span><span style="white-space:nowrap;">${SCRAP_ICON}${sc} Scrap</span></div>`);
        } else {
          const ing = qtys[k] * prices[k];
          if (isSell) {
            parts.push(`<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;"><span>${formatQuantity(k, qtys[k])}</span><span style="white-space:nowrap;">${INGOT_ICON}<span style="color:#57ff57">‚àí${ing} Ingot${ing!==1?'s':''}</span></span></div>`);
          } else {
            parts.push(`<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;"><span>${formatQuantity(k, qtys[k])}</span><span style="white-space:nowrap;">${INGOT_ICON}${ing} Ingot${ing!==1?'s':''}</span></div>`);
          }
        }
      }
    }
    // Convert everything to scrap units for net calculation
    // totalIngots can be negative (sell items), totalScrap is always positive (gear cost)
    const extraIngots = Math.floor(totalScrap / 4);
    const remScrap = totalScrap % 4;
    totalIngots += extraIngots;
    // totalIngots from sell items (negative) + gear scrap converted to ingots
    // remScrap = leftover gear scrap that didn't convert to ingots
    const totalParts = [];
    if (totalIngots >= 0) {
      // Customer owes ingots + leftover scrap
      if (totalIngots > 0) totalParts.push('<img src="netherite_ingot.png" style="width:18px;height:18px;image-rendering:pixelated;vertical-align:middle;margin-right:4px;" onerror="this.replaceWith(document.createTextNode(\'üíé\'))">' + totalIngots + ' Ingot' + (totalIngots!==1?'s':''));
      if (remScrap > 0) totalParts.push('<img src="netherite_scrap.png" style="width:18px;height:18px;image-rendering:pixelated;vertical-align:middle;margin-right:4px;" onerror="this.replaceWith(document.createTextNode(\'ü™®\'))">' + remScrap + ' Scrap');
    } else {
      // Net discount ‚Äî convert total negative ingots back to scrap, then re-split into ingots+scrap
      // e.g. totalIngots=-3, remScrap=1 ‚Üí raw discount = 3*4 - 1 = 11 scrap ‚Üí 2 ingots + 3 scrap
      const rawDiscountScrap = Math.abs(totalIngots) * 4 - remScrap;
      const discountIngots = Math.floor(rawDiscountScrap / 4);
      const discountRemScrap = rawDiscountScrap % 4;
      if (discountIngots > 0) totalParts.push('<img src="netherite_ingot.png" style="width:18px;height:18px;image-rendering:pixelated;vertical-align:middle;margin-right:4px;" onerror="this.replaceWith(document.createTextNode(\'üíé\'))"><span style="color:#57ff57">‚àí' + discountIngots + ' Ingot' + (discountIngots!==1?'s':'') + ' discount</span>');
      if (discountRemScrap > 0) totalParts.push('<img src="netherite_scrap.png" style="width:18px;height:18px;image-rendering:pixelated;vertical-align:middle;margin-right:4px;" onerror="this.replaceWith(document.createTextNode(\'ü™®\'))"><span style="color:#57ff57">‚àí' + discountRemScrap + ' Scrap discount</span>');
    }
    document.getElementById('cart-total').innerHTML = totalParts.length ? totalParts.join(' <span style="color:#9a8c76">+</span> ') : '0';
    document.getElementById('cart-items').innerHTML = parts.length ? parts.join('') : '<span style="color:#9a8c76">No items selected</span>';
  }


  function formatQuantity(key, qty) {
    if (key === 'tnt') {
      const stacks = qty * 3;
      const shulkers = Math.floor(stacks / 27);
      const rem = stacks % 27;
      if (shulkers > 0 && rem > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} + ${rem} Stack${rem>1?'s':''} of TNT`;
      if (shulkers > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} of TNT`;
      return `${stacks} Stack${stacks>1?'s':''} of TNT`;
    } else if (key === 'breeze') {
      const stacks = qty * 3;
      const shulkers = Math.floor(stacks / 27);
      const rem = stacks % 27;
      if (shulkers > 0 && rem > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} + ${rem} Stack${rem>1?'s':''} of Breeze Rods`;
      if (shulkers > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} of Breeze Rods`;
      return `${stacks} Stack${stacks>1?'s':''} of Breeze Rods`;
    } else if (key === 'crystal') {
      const shulkers = Math.floor(qty / 27);
      const rem = qty % 27;
      if (shulkers > 0 && rem > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} + ${rem} Stack${rem>1?'s':''} of End Crystals`;
      if (shulkers > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} of End Crystals`;
      return `${qty} Stack${qty>1?'s':''} of End Crystals`;
    } else if (key === 'blazeRod') {
      const stacks = qty * 3;
      const shulkers = Math.floor(stacks / 27);
      const rem = stacks % 27;
      if (shulkers > 0 && rem > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} + ${rem} Stack${rem>1?'s':''} of Blaze Rods`;
      if (shulkers > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} of Blaze Rods`;
      return `${stacks} Stack${stacks>1?'s':''} of Blaze Rods`;
    } else if (key === 'anchor') {
      const shulkers = Math.floor(qty / 27);
      const rem = qty % 27;
      if (shulkers > 0 && rem > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} + ${rem} Stack${rem>1?'s':''} of Respawn Anchors`;
      if (shulkers > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} of Respawn Anchors`;
      return `${qty} Stack${qty>1?'s':''} of Respawn Anchors`;
    } else if (key === 'sand') {
      const shulkers = qty;
      return `${shulkers} Shulker Box${shulkers>1?'es':''} of Sand (Selling)`;
    } else if (key === 'shulkerShell') {
      return `${qty * 32} Shulker Shell${qty * 32 !== 1 ? 's' : ''}`;
    } else if (key === 'elytra') {
      return `${qty} Elytra`;
    } else {
      // unstackable items (mace, pickaxe, axe, shovel)
      const shulkers = Math.floor(qty / 27);
      const rem = qty % 27;
      if (shulkers > 0 && rem > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} + ${rem} ${cartNames[key]}`;
      if (shulkers > 0) return `${shulkers} Shulker Box${shulkers>1?'es':''} of ${cartNames[key]}`;
      return `${qty} ${cartNames[key]}`;
    }
  }
  function checkout() {
    let hasItems = false;
    for (const k in qtys) { if (qtys[k] > 0) hasItems = true; }
    if (!hasItems) { showToast('‚ö† Select at least one item first!'); return; }

    // Build summary for payment modal
    let summary = [];
    let total = 0;
    let totalScrapCost = 0;
    for (const k in qtys) {
      if (qtys[k] > 0) {
        const display = formatQuantity(k, qtys[k]);
        const isSell = sellItems.has(k);
        if (scrapPrices[k]) {
          const scrapCost = qtys[k] * scrapPrices[k];
          totalScrapCost += scrapCost;
          summary.push(`<span style="color:#ede9e0">${display}</span><span style="color:#c084fc;float:right;padding-left:24px">${MODAL_SCRAP_ICON}${scrapCost} Scrap</span>`);
        } else {
          const cost = qtys[k] * prices[k];
          if (isSell) {
            total -= cost;
            summary.push(`<span style="color:#ede9e0">${display}</span><span style="color:#57ff57;float:right;padding-left:24px">${MODAL_INGOT_ICON}‚àí${cost} Ingot${cost>1?'s':''} (selling)</span>`);
          } else {
            total += cost;
            summary.push(`<span style="color:#ede9e0">${display}</span><span style="color:var(--gold);float:right;padding-left:24px">${MODAL_INGOT_ICON}${cost} Ingot${cost>1?'s':''}</span>`);
          }
        }
      }
    }
    summary.push(`<span style="color:#9a8c76;font-size:0.72rem">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>`);
    const totalParts = [];
    if (total > 0) totalParts.push(`${MODAL_INGOT_ICON}${total} Netherite Ingot${total>1?'s':''}`);
    else if (total < 0) totalParts.push(`${MODAL_INGOT_ICON}<span style="color:#57ff57">‚àí${Math.abs(total)} Ingot${Math.abs(total)!==1?'s':''} discount</span>`);
    if (totalScrapCost > 0) totalParts.push(`${MODAL_SCRAP_ICON}${totalScrapCost} Netherite Scrap`);
    summary.push(`<span style="color:var(--gold);font-weight:bold">TOTAL</span><span style="color:var(--gold);float:right;padding-left:24px;font-weight:bold">${totalParts.join(' + ')}</span>`);
    document.getElementById('payment-order-summary').innerHTML = summary.join('<br>');
    document.getElementById('paymentModal').classList.add('active');
  }

  function closePaymentModal() {
    document.getElementById('paymentModal').classList.remove('active');
  }

  function acceptPayment() {
    closePaymentModal();
    openModal();
  }

  function openModal() {
    document.getElementById('usernameModal').classList.add('active');
    setTimeout(() => document.getElementById('usernameInput').focus(), 100);
  }

  function closeModal() {
    document.getElementById('usernameModal').classList.remove('active');
    document.getElementById('usernameInput').value = '';
  }

  function confirmOrder() {
    const username = document.getElementById('usernameInput').value.trim();
    if (!username) {
      document.getElementById('usernameInput').style.borderColor = 'var(--red)';
      setTimeout(() => document.getElementById('usernameInput').style.borderColor = '', 1000);
      return;
    }
    closeModal();

    let lines = [];
    let total = 0;
    let totalScrap = 0;
    for (const k in qtys) {
      if (qtys[k] > 0) {
        const display = formatQuantity(k, qtys[k]);
        const isSell = sellItems.has(k);
        if (scrapPrices[k]) {
          const scrapCost = qtys[k] * scrapPrices[k];
          totalScrap += scrapCost;
          lines.push(`${display}  ‚Äî  ${scrapCost} Netherite Scrap`);
        } else {
          const cost = qtys[k] * prices[k];
          if (isSell) {
            total -= cost;
            lines.push(`${display}  ‚Äî  ‚àí${cost} ingot${cost>1?'s':''} (selling)`);
          } else {
            total += cost;
            lines.push(`${display}  ‚Äî  ${cost} ingot${cost>1?'s':''}`);
          }
        }
      }
    }
    const totalParts2 = [];
    if (total > 0) totalParts2.push(total + ' Netherite Ingot' + (total>1?'s':''));
    if (totalScrap > 0) totalParts2.push(totalScrap + ' Netherite Scrap');
    const orderText = lines.join('\n') + '\n\n' + '‚îÄ'.repeat(30) + '\nTOTAL: ' + totalParts2.join(' + ');
    const notes = document.getElementById('orderNotes').value.trim();

    const btn = document.querySelector('.checkout-btn');
    btn.textContent = '‚è≥ Sending...';
    btn.disabled = true;

    emailjs.send('service_e7kk3se', 'template_1iekv7g', {
      username: username,
      order: orderText,
      total: totalParts2.join(' + '),
      notes: notes || '(none)'
    }).then(() => {
      for (const k in qtys) { purchased[k] += qtys[k]; qtys[k] = 0; }
      ['tnt','mace','breeze','crystal','anchor','elytra','blazeRod','shulkerShell','sand','pickaxe','axe','shovel'].forEach(k => {
        ['', '-all'].forEach(suffix => { const el = document.getElementById(k+'-qty'+suffix); if(el) el.textContent = 0; });
      });
      document.getElementById('orderNotes').value = '';
      updateTotal();
      btn.textContent = '‚úâ Send Order';
      btn.disabled = false;
      showToast('‚úÖ Order sent! Meet the shop owner in-game.');
    }).catch((err) => {
      console.error('EmailJS error:', JSON.stringify(err));
      btn.textContent = '‚úâ Send Order';
      btn.disabled = false;
      const msg = 'EmailJS Error ' + (err.status || '?') + ': ' + (err.text || JSON.stringify(err));
      document.getElementById('error-msg').textContent = msg;
      document.getElementById('error-box').style.display = 'flex';
    });
  }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.style.borderColor = msg.startsWith('‚ö†') ? '#f5c842' : 'var(--gold)';
    t.style.color = msg.startsWith('‚ö†') ? '#f5c842' : 'var(--gold)';
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 4000);
  }
</script>


<!-- Enchant Info Modal -->
<div class="modal-overlay" id="enchantModal" onclick="if(event.target===this)closeEnchantModal()">
  <div class="modal-box" style="max-width:380px;">
    <h2 style="display:flex;align-items:center;gap:10px;justify-content:center;">
      <img src="enchanted_book.png" alt="" style="width:28px;height:28px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
      Elytra Enchants
    </h2>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div style="display:flex;align-items:center;gap:12px;background:rgba(192,132,252,0.08);border:1px solid rgba(192,132,252,0.3);border-radius:4px;padding:12px 14px;">
        <img src="enchanted_book.png" style="width:24px;height:24px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
        <div>
          <div style="font-size:0.82rem;color:#c084fc;letter-spacing:0.06em;">Unbreaking III</div>
          <div style="font-size:0.65rem;color:#9a8c76;margin-top:3px;">Reduces durability loss significantly</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;background:rgba(192,132,252,0.08);border:1px solid rgba(192,132,252,0.3);border-radius:4px;padding:12px 14px;">
        <img src="enchanted_book.png" style="width:24px;height:24px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
        <div>
          <div style="font-size:0.82rem;color:#c084fc;letter-spacing:0.06em;">Mending</div>
          <div style="font-size:0.65rem;color:#9a8c76;margin-top:3px;">Repairs using XP orbs collected</div>
        </div>
      </div>
    </div>
    <div class="modal-btns">
      <button class="modal-confirm" onclick="closeEnchantModal()" style="flex:1;">Close</button>
    </div>
  </div>
</div>

<!-- Gear Enchant Modal -->
<div class="modal-overlay" id="gearEnchantModal" onclick="if(event.target===this)closeGearEnchantModal()">
  <div class="modal-box" style="max-width:380px;">
    <h2 style="display:flex;align-items:center;gap:10px;justify-content:center;">
      <img src="enchanted_book.png" alt="" style="width:28px;height:28px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
      Gear Enchants
    </h2>
    <div style="display:flex;flex-direction:column;gap:8px;">
      <div style="display:flex;align-items:center;gap:12px;background:rgba(192,132,252,0.08);border:1px solid rgba(192,132,252,0.3);border-radius:4px;padding:10px 14px;">
        <img src="enchanted_book.png" style="width:22px;height:22px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
        <div>
          <div style="font-size:0.8rem;color:#c084fc;letter-spacing:0.06em;">Mending</div>
          <div style="font-size:0.62rem;color:#9a8c76;margin-top:2px;">Repairs using XP orbs collected</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;background:rgba(192,132,252,0.08);border:1px solid rgba(192,132,252,0.3);border-radius:4px;padding:10px 14px;">
        <img src="enchanted_book.png" style="width:22px;height:22px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
        <div>
          <div style="font-size:0.8rem;color:#c084fc;letter-spacing:0.06em;">Unbreaking III</div>
          <div style="font-size:0.62rem;color:#9a8c76;margin-top:2px;">Reduces durability loss significantly</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;background:rgba(192,132,252,0.08);border:1px solid rgba(192,132,252,0.3);border-radius:4px;padding:10px 14px;">
        <img src="enchanted_book.png" style="width:22px;height:22px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
        <div>
          <div style="font-size:0.8rem;color:#c084fc;letter-spacing:0.06em;">Efficiency V</div>
          <div style="font-size:0.62rem;color:#9a8c76;margin-top:2px;">Maximum mining/chopping speed</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;background:rgba(192,132,252,0.08);border:1px solid rgba(192,132,252,0.3);border-radius:4px;padding:10px 14px;">
        <img src="enchanted_book.png" style="width:22px;height:22px;image-rendering:pixelated;" onerror="this.outerHTML='üìñ'">
        <div>
          <div style="font-size:0.8rem;color:#c084fc;letter-spacing:0.06em;">Silk Touch</div>
          <div style="font-size:0.62rem;color:#9a8c76;margin-top:2px;">Drops blocks in their original form</div>
        </div>
      </div>
    </div>
    <div class="modal-btns">
      <button class="modal-confirm" onclick="closeGearEnchantModal()" style="flex:1;">Close</button>
    </div>
  </div>
</div>

</body>
</html>